name: Build All LaTeX Documents

on:
  push:
    branches: [ main ]
  pull_request:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # 1Ô∏è‚É£ R√©cup√©ration du d√©p√¥t
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2Ô∏è‚É£ Installation de LaTeX complet (TeX Live)
      - name: Set up LaTeX environment
        run: |
          sudo apt-get update
          sudo apt-get install -y texlive-full latexmk

      # 3Ô∏è‚É£ Compilation de tous les fichiers LaTeX cibl√©s
      - name: Compile all LaTeX files
        run: |
          mkdir -p output_pdfs
          find . -type f \( -name "Cours.tex" -o -name "TD.tex" -o -name "TP.tex" -o -name "Cheetsheet.tex" -o -name "Diapo.tex" -o -name "Poster.tex" \) | while read file; do
            echo "üìÑ Compilation de $file ..."
            dir=$(dirname "$file")
            name=$(basename "$file" .tex)
            cd "$dir"
            latexmk -pdf -interaction=nonstopmode "$name.tex"
            mv "$name.pdf" "$GITHUB_WORKSPACE/output_pdfs/${dir//\//_}_$name.pdf" || echo "‚ö†Ô∏è PDF non trouv√© pour $file"
            cd "$GITHUB_WORKSPACE"
          done

      # 4Ô∏è‚É£ Upload de tous les PDF produits
      - name: Upload all PDFs
        uses: actions/upload-artifact@v4
        with:
          name: latex-pdfs
          path: output_pdfs/
