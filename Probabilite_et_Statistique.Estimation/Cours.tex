\documentclass[12pt,a4paper]{book}

% ===== ENCODAGE ET LANGUE =====
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[french]{babel}
\usepackage{lmodern}

% ===== MISE EN PAGE =====
\usepackage[left=2.5cm, right=2.5cm, top=2.5cm, bottom=2.5cm]{geometry}
\usepackage{setspace}
\onehalfspacing

% ===== MATHÉMATIQUES =====
\usepackage{amsmath, amssymb, amsthm}
\usepackage{mathtools}
\usepackage{bm}

% ===== FIGURES, TABLEAUX, CODE =====
\usepackage{graphicx}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{float}
\usepackage{booktabs}
\usepackage{array}
\usepackage{multirow}
\usepackage{xcolor}
\usepackage{listings}

\lstloadlanguages{Python, R, SQL}

% ===== BOÎTES MINIMALISTES =====
\usepackage{mdframed}

% ===== STRUCTURE ET NAVIGATION =====
\usepackage{titlesec}
\usepackage{titletoc}
\usepackage{fancyhdr}
\setlength{\headheight}{14.5pt}
\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=black,
    citecolor=blue,
    urlcolor=blue,
    bookmarks=true,
    bookmarksopen=true
}

% ===== LISTES PERSONNALISÉES =====
\usepackage{enumitem}
\setlist[itemize]{itemsep=0.3em, topsep=0.5em}
\setlist[enumerate]{itemsep=0.3em, topsep=0.5em}

% ===== EN-TÊTES ET PIEDS =====
\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{\leftmark}
\fancyhead[R]{\thepage}
\renewcommand{\headrulewidth}{0.4pt}

% ===== NUMÉROTATION DES ÉQUATIONS =====
\numberwithin{equation}{chapter}

% ===== DÉFINITION STYLES DE LISTINGS =====
% --- Packages nécessaires ---
\usepackage[most]{tcolorbox}
\usepackage{listings}
\usepackage{xcolor}

% --- Couleurs des headers ---
% Python
\definecolor{pyhead}{RGB}{30,60,160}        % bleu foncé
\definecolor{pyheadlight}{RGB}{180,200,255} % bleu clair output

% R
\definecolor{rhead}{RGB}{180,20,20}         % rouge foncé
\definecolor{rheadlight}{RGB}{255,200,200}  % rouge clair output

% SQL
\definecolor{sqlhead}{RGB}{40,140,230}       % bleu clair
\definecolor{sqlheadlight}{RGB}{200,230,255} % bleu très clair output

% --- Style listings : texte noir, syntaxe sobre ---
\lstset{
    basicstyle=\ttfamily\small\color{black},
    commentstyle=\color{gray}\itshape,
    stringstyle=\color{gray!70},
    keywordstyle=\bfseries\color{black},
    breaklines=true,
    numbers=left,
    numberstyle=\tiny\color{gray},
}

% ====== PYTHON ======
\newtcolorbox{pycodebox}{
    colback=white,
    colframe=pyhead,
    fonttitle=\bfseries\ttfamily\small,
    coltitle=white,
    title=Python,
    enhanced,
    sharp corners,
    top=2pt, bottom=2pt, left=2pt, right=2pt,
    attach boxed title to top left={
        xshift=2pt, yshift*=-\tcboxedtitleheight
    },
    boxed title style={
        colback=pyhead,
        colframe=pyhead,
        boxrule=0.8pt,
        sharp corners
    }
}

\newtcolorbox{pyoutputbox}{
    colback=white,
    colframe=pyheadlight,
    fonttitle=\bfseries\ttfamily\small,
    coltitle=black,
    title=Python~Output,
    enhanced,
    sharp corners,
    top=2pt, bottom=2pt, left=2pt, right=2pt,
    attach boxed title to top left={
        xshift=2pt, yshift*=-\tcboxedtitleheight
    },
    boxed title style={
        colback=pyheadlight,
        colframe=pyheadlight,
        boxrule=0.8pt,
        sharp corners
    }
}

% ====== R ======
\newtcolorbox{rcodebox}{
    colback=white,
    colframe=rhead,
    fonttitle=\bfseries\ttfamily\small,
    coltitle=white,
    title=R,
    enhanced,
    sharp corners,
    top=2pt, bottom=2pt, left=2pt, right=2pt,
    attach boxed title to top left={
        xshift=2pt, yshift*=-\tcboxedtitleheight
    },
    boxed title style={
        colback=rhead,
        colframe=rhead,
        boxrule=0.8pt,
        sharp corners
    }
}

\newtcolorbox{routputbox}{
    colback=white,
    colframe=rheadlight,
    fonttitle=\bfseries\ttfamily\small,
    coltitle=black,
    title=R~Output,
    enhanced,
    sharp corners,
    top=2pt, bottom=2pt, left=2pt, right=2pt,
    attach boxed title to top left={
        xshift=2pt, yshift*=-\tcboxedtitleheight
    },
    boxed title style={
        colback=rheadlight,
        colframe=rheadlight,
        boxrule=0.8pt,
        sharp corners
    }
}

% ====== SQL ======
\newtcolorbox{sqlcodebox}{
    colback=white,
    colframe=sqlhead,
    fonttitle=\bfseries\ttfamily\small,
    coltitle=white,
    title=SQL,
    enhanced,
    sharp corners,
    top=2pt, bottom=2pt, left=2pt, right=2pt,
    attach boxed title to top left={
        xshift=2pt, yshift*=-\tcboxedtitleheight
    },
    boxed title style={
        colback=sqlhead,
        colframe=sqlhead,
        boxrule=0.8pt,
        sharp corners
    }
}

\newtcolorbox{sqloutputbox}{
    colback=white,
    colframe=sqlheadlight,
    fonttitle=\bfseries\ttfamily\small,
    coltitle=black,
    title=SQL~Output,
    enhanced,
    sharp corners,
    top=2pt, bottom=2pt, left=2pt, right=2pt,
    attach boxed title to top left={
        xshift=2pt, yshift*=-\tcboxedtitleheight
    },
    boxed title style={
        colback=sqlheadlight,
        colframe=sqlheadlight,
        boxrule=0.8pt,
        sharp corners
    }
}

% ===== COMMANDES PERSONNALISÉES MATHS =====
\newcommand{\dd}{\mathrm{d}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\C}{\mathbb{C}}

% ===== COULEURS DOUCES =====
\definecolor{redsoft}{RGB}{230, 100, 100}
\definecolor{redbg}{RGB}{255, 245, 245}
\definecolor{yellowsoft}{RGB}{220, 180, 80}
\definecolor{yellowbg}{RGB}{255, 252, 240}
\definecolor{graysoft}{RGB}{140, 140, 140}
\definecolor{graybg}{RGB}{248, 248, 248}

% ===== STYLES DES BOÎTES =====
\mdfdefinestyle{thmstyle}{
    linecolor=redsoft,
    linewidth=1.5pt,
    backgroundcolor=redbg,
    innerleftmargin=8pt,
    innerrightmargin=8pt,
    innertopmargin=6pt,
    innerbottommargin=6pt,
    skipabove=0.8em,
    skipbelow=0.8em
}

\mdfdefinestyle{exstyle}{
    linecolor=yellowsoft,
    linewidth=1.5pt,
    backgroundcolor=yellowbg,
    innerleftmargin=8pt,
    innerrightmargin=8pt,
    innertopmargin=6pt,
    innerbottommargin=6pt,
    skipabove=0.8em,
    skipbelow=0.8em
}

\mdfdefinestyle{remstyle}{
    linecolor=graysoft,
    linewidth=1.5pt,
    backgroundcolor=graybg,
    innerleftmargin=8pt,
    innerrightmargin=8pt,
    innertopmargin=6pt,
    innerbottommargin=6pt,
    skipabove=0.8em,
    skipbelow=0.8em
}

% ===== ENVIRONNEMENTS =====
\theoremstyle{definition}
\newmdtheoremenv[style=thmstyle]{definition}{Définition}[chapter]
\newmdtheoremenv[style=thmstyle]{notation}{Notation}[chapter]
\newmdtheoremenv[style=exstyle]{exemple}{Exemple}[chapter]
\newmdtheoremenv[style=remstyle]{remarque}{Remarque}[chapter]
\newmdtheoremenv[style=remstyle]{note}{Note}[chapter]

\theoremstyle{plain}
\newmdtheoremenv[style=thmstyle]{theoreme}{Théorème}[chapter]
\newmdtheoremenv[style=thmstyle]{proposition}{Proposition}[chapter]
\newmdtheoremenv[style=thmstyle]{lemme}{Lemme}[chapter]
\newmdtheoremenv[style=thmstyle]{corollaire}{Corollaire}[chapter]

% ===== DOCUMENT =====
\begin{document}

\frontmatter
\title{Estimation}
\author{Lorenzo Segoni}
\date{\today}
\maketitle

\tableofcontents

\mainmatter

% Exemple de chapitre
\input{Ch1}
\input{Ch2}

\end{document}
